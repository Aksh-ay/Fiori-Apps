<mvc:View controllerName="zsd_sales_ovw.controller.Overview"
    xmlns:mvc="sap.ui.core.mvc" displayBlock="true"
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:layout="sap.ui.layout"
    xmlns:table="sap.ui.table">
    <App id="Overview">
        <pages>
            <Page id="overviewPage" enableScrolling="false" showHeader="false" showFooter="false">
                <layout:DynamicSideContent id="dsc" sideContentPosition="Begin" sideContentVisibility="AlwaysShow" equalSplit="false" showSideContent="true">
                    <layout:sideContent>
                        <VBox class="sapUiSmallMargin">
                            <Toolbar>
                                <Title text="" />
                                <ToolbarSpacer />
                                <Button id="btnToggleSide" text="Filters" type="Transparent" icon="sap-icon://menu2" press=".onToggleSideContent" />
                            </Toolbar>

                            <VBox class="sapUiSmallMarginTop">
                                <HBox>
                                    <Label text="Year" class="FilterTextStyle" labelFor="fYear" width="7rem" />
                                    <MultiComboBox id="fYear" maxWidth="100%" width="5rem" items="{ path: 'oGlobalModel>/YearList' }">
                                        <items>
                                            <core:Item key="{oGlobalModel>key}" text="{oGlobalModel>text}" />
                                        </items>
                                    </MultiComboBox>
                                </HBox>
                                <HBox>
                                    <Label text="Quarter" class="FilterTextStyle" labelFor="fQuarter" width="7rem" />
                                    <MultiComboBox id="fQuarter" width="5rem" items="{ path: 'oGlobalModel>/QuarterList' }">
                                        <items>
                                            <core:Item key="{oGlobalModel>key}" text="{oGlobalModel>text}" />
                                        </items>
                                    </MultiComboBox>
                                </HBox>
                                <HBox>
                                    <Label text="Month" class="FilterTextStyle" labelFor="fMonth" width="7rem" />
                                    <MultiComboBox id="fMonth" width="5rem" items="{ path: 'oGlobalModel>/MonthList' }">
                                        <items>
                                            <core:Item key="{oGlobalModel>key}" text="{oGlobalModel>text}" />
                                        </items>
                                    </MultiComboBox>
                                </HBox>
                                <HBox>
                                    <Label text="Source Mill" class="FilterTextStyle" labelFor="fSourceMill" width="7rem" />
                                    <MultiComboBox id="fSourceMill" width="5rem" items="{ path: 'oGlobalModel>/SourceMillList' }">
                                        <items>
                                            <core:Item key="{oGlobalModel>key}" text="{oGlobalModel>text}" />
                                        </items>
                                    </MultiComboBox>
                                </HBox>
                                <HBox>
                                    <Label text="Type of Sales" class="FilterTextStyle" labelFor="fTypeSales" width="7rem" />
                                    <MultiComboBox id="fTypeSales" width="5rem" items="{ path: 'oGlobalModel>/TypeOfSalesList' }">
                                        <items>
                                            <core:Item key="{oGlobalModel>key}" text="{oGlobalModel>text}" />
                                        </items>
                                    </MultiComboBox>
                                </HBox>
                                <HBox>
                                    <Label text="Product Category" class="FilterTextStyle" labelFor="fProdCat" width="7rem" />
                                    <MultiComboBox id="fProdCat" width="5rem" items="{ path: 'oGlobalModel>/ProductCategoryList' }">
                                        <items>
                                            <core:Item key="{oGlobalModel>key}" text="{oGlobalModel>text}" />
                                        </items>
                                    </MultiComboBox>
                                </HBox>

                                <HBox>
                                    <Label text="Quantity" class="FilterTextStyle" width="4rem" />
                                    <Select id="fQtyOp" width="4rem" forceSelection="false" selectedKey="{view>/qty/op}" tooltip="Operator">
                                        <core:Item key="EQ" text=" = " />
                                        <core:Item key="NE" text=" ≠ " />
                                        <core:Item key="GT" text="> " />
                                        <core:Item key="GE" text=" ≥ " />
                                        <core:Item key="LT" text=" &lt; " />
                                        <core:Item key="LE" text=" ≤ " />
                                        <core:Item key="BT" text="Between" />
                                    </Select>

                                    <ToolbarSpacer width="0.5rem" />
                                    <Input id="fQtyVal1" width="4rem" type="Number" placeholder="{= ${view>/qty/op} === 'BT' ? 'From' : 'Value'}" value="{view>/qty/v1}" />

                                    <ToolbarSpacer width="0.5rem" />
                                    <Input id="fQtyVal2" width="4rem" type="Number" placeholder="To" value="{view>/qty/v2}" visible="{= ${view>/qty/op} === 'BT' }" />
                                </HBox>

                                <HBox>
                                    <Label text="Value" class="FilterTextStyle" width="4rem" />
                                    <Select id="fUsdOp" width="4rem" forceSelection="false" selectedKey="{view>/usd/op}" tooltip="Operator">
                                        <core:Item key="EQ" text=" = " />
                                        <core:Item key="NE" text=" ≠ " />
                                        <core:Item key="GT" text="> " />
                                        <core:Item key="GE" text=" ≥ " />
                                        <core:Item key="LT" text=" &lt; " />
                                        <core:Item key="LE" text=" ≤ " />
                                        <core:Item key="BT" text="Between" />
                                    </Select>

                                    <ToolbarSpacer width="0.5rem" />
                                    <Input id="fUsdVal1" width="4rem" type="Number" placeholder="{= ${view>/usd/op} === 'BT' ? 'From' : 'Value'}" value="{view>/usd/v1}" />

                                    <ToolbarSpacer width="0.5rem" />
                                    <Input id="fUsdVal2" width="4rem" type="Number" placeholder="To" value="{view>/usd/v2}" visible="{= ${view>/usd/op} === 'BT' }" />
                                </HBox>

                                <HBox class="sapUiSmallMarginTop">
                                    <!-- <Button text="Apply" type="Emphasized" press=".onApplyFilters"/> -->
                                    <!-- <ToolbarSpacer/> -->
                                    <Button text="Reset" type="Transparent" press=".onResetFilters" />
                                </HBox>
                            </VBox>
                        </VBox>
                    </layout:sideContent>

                    <layout:mainContent>
                        <!-- Make this VBox a flex container that fills the available height -->
                        <VBox class="sapUiSmallMargin" height="100%">
                            <!-- Toolbar (unchanged) -->
                            <OverflowToolbar id="mainToolbar" design="Auto" class="sapUiSmallMarginBottom">
                                <Button id="btnToggleMain" text="Filters" type="Transparent" icon="sap-icon://menu2" press=".onToggleMainContent">
                                    <layoutData>
                                        <OverflowToolbarLayoutData priority="NeverOverflow" />
                                    </layoutData>
                                </Button>

                                <ToolbarSpacer />
                                <Button id="btnSync" text="" icon="sap-icon://synchronize" type="Transparent" press=".onSyncOverview"/>
                                <Button id="btnCharts" text="Charts" icon="sap-icon://business-objects-experience" type="Transparent" press=".onOpenChartDialog"/>
                                <Button id="btnSort" text="Sort" icon="sap-icon://sort" type="Transparent" press=".onOpenSortDialog">
                                    <layoutData>
                                        <OverflowToolbarLayoutData priority="NeverOverflow" />
                                    </layoutData>
                                </Button>

                                <Button id="btnExport" text="Export to Excel" icon="sap-icon://excel-attachment" type="Transparent" press=".onExportExcel">
                                    <layoutData>
                                        <OverflowToolbarLayoutData priority="NeverOverflow" />
                                    </layoutData>
                                </Button>
                            </OverflowToolbar>

                            <!-- Token rows (unchanged) -->
                            <VBox id="tokenRows" visible="{= !!${view>/filterChips}.length }" class="sapUiSmallMarginBottom">
                                <!-- Row 1 -->
                                <HBox renderType="Bare" visible="{= !!${view>/filterChipsTop}.length }">
                                    <Text text="Selected:" class="sapUiTinyMarginEnd sapUiTinyMarginBegin" />
                                    <Tokenizer id="activeFilterTokensTop" editable="true" tokenDelete=".onFilterTokenDelete" tokens="{path: 'view>/filterChipsTop'}">
                                        <Token key="{view>key}" text="{view>text}">
                                            <customData>
                                                <core:CustomData key="type" value="{view>type}" writeToDom="false" />
                                                <core:CustomData key="value" value="{view>value}" writeToDom="false" />
                                            </customData>
                                        </Token>
                                    </Tokenizer>
                                </HBox>

                                <!-- Row 2 -->
                                <HBox renderType="Bare" visible="{= !!${view>/filterChipsBottom}.length }">
                                    <Text text="" class="sapUiTinyMarginEnd sapUiTinyMarginBegin" />
                                    <Tokenizer id="activeFilterTokensBottom" editable="true" tokenDelete=".onFilterTokenDelete" tokens="{path: 'view>/filterChipsBottom'}">
                                        <Token key="{view>key}" text="{view>text}">
                                            <customData>
                                                <core:CustomData key="type" value="{view>type}" writeToDom="false" />
                                                <core:CustomData key="value" value="{view>value}" writeToDom="false" />
                                            </customData>
                                        </Token>
                                    </Tokenizer>
                                </HBox>
                            </VBox>

                            <!-- SCROLLABLE AREA: fills the remaining page height -->
                            <ScrollContainer id="tblScroll" width="100%" height="65%" vertical="true" horizontal="true" focusable="true">
                                <!-- Let this ScrollContainer grow to fill the VBox -->
                                <layoutData>
                                    <FlexItemData growFactor="1" />
                                </layoutData>

                                <Table id="salesTable" inset="false" growing="true" growingThreshold="10000" growingScrollToLoad="true" width="100%" items="{oGlobalModel>/SalesData}" sticky="ColumnHeaders">
                                    <columns>
                                        <Column width="6rem">
                                            <Text text="Year" />
                                        </Column>
                                        <Column width="6rem">
                                            <Text text="Quarter" />
                                        </Column>
                                        <Column width="6rem">
                                            <Text text="Month" />
                                        </Column>
                                        <Column width="8rem">
                                            <Text text="Source Mill" />
                                        </Column>
                                        <Column width="8rem">
                                            <Text text="Type of Sales" />
                                        </Column>
                                        <Column width="8rem">
                                            <Text text="Product Category" />
                                        </Column>
                                        <Column hAlign="End" width="10rem">
                                            <Text text="Quantity" />
                                        </Column>
                                        <Column hAlign="End" width="10rem">
                                            <Text text="USD Value" />
                                        </Column>
                                    </columns>
                                    <items>
                                        <ColumnListItem vAlign="Middle">
                                            <cells>
                                                <Text text="{oGlobalModel>Year}" />
                                                <Text text="{oGlobalModel>Quater}" />
                                                <Text text="{oGlobalModel>Month}" />
                                                <Text text="{oGlobalModel>SourceMill}" />
                                                <Text text="{oGlobalModel>TypeOfSales}" />
                                                <Text text="{oGlobalModel>ProductCategory}" />

                                                <!-- Quantity (short form + full value on hover) -->
                                                <Text text="{ path: 'oGlobalModel>Quantity', formatter: '.formatShortNumber' }" tooltip="{ path: 'oGlobalModel>Quantity', formatter: '.formatFullNumber' }" />

                                                <!-- USD Value (short form + full value on hover) -->
                                                <Text text="{ path: 'oGlobalModel>Usd', formatter: '.formatShortCurrency' }" tooltip="{ path: 'oGlobalModel>Usd', formatter: '.formatFullCurrency' }" />

                                            </cells>
                                        </ColumnListItem>
                                    </items>
                                </Table>
                            </ScrollContainer>
                        </VBox>
                    </layout:mainContent>
                </layout:DynamicSideContent>
            </Page>
        </pages>
    </App>
</mvc:View>
